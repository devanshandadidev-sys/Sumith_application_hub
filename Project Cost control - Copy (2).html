<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Resource Quantifier & Verifier</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom styles for dark mode and smooth transitions */
        :root {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #4b5563; /* Gray-600 */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background-color: #1f2937; /* Gray-800 */
        }
        /* Hide scrollbar on modal open */
        .modal-open {
            overflow: hidden;
        }

        /* --- CONCISE PRINT REPORT STYLES --- */
        @media print {
            body {
                background-color: #fff;
                color: #000;
            }
            /* Hide non-report elements */
            #app:not(.print-mode) { display: none; }
            #app.print-mode header,
            #app.print-mode #control-panel,
            #app.print-mode #toast-container,
            #app.print-mode #delete-modal,
            #app.print-mode .action-buttons,
            #app.print-mode .page-tab,
            #app.print-mode #search-input,
            #app.print-mode .hidden-print {
                display: none !important;
            }

            /* Make report sections visible and full-width */
            #app.print-mode main {
                max-width: none !important;
                padding: 0 !important;
            }
            #app.print-mode #dashboard-view,
            #app.print-mode #report-view-content {
                display: block !important;
                margin: 0;
                padding: 10mm;
            }

            /* Clean up table styles for print */
            #app.print-mode table {
                width: 100%;
                border-collapse: collapse;
                page-break-inside: auto;
            }
            #app.print-mode table thead {
                display: table-header-group;
                background-color: #f0f0f0;
            }
            #app.print-mode table tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }
            #app.print-mode table th,
            #app.print-mode table td {
                border: 1px solid #ccc;
                padding: 8px;
                font-size: 10pt;
                color: #000; /* Ensure text is black for printing */
            }

            /* KPI and Breakdown formatting */
            #app.print-mode .kpi-card {
                background-color: #fff !important;
                border: 1px solid #ccc !important;
                box-shadow: none !important;
                color: #000 !important;
                padding: 10px;
            }
            #app.print-mode h1, #app.print-mode h2, #app.print-mode h3 {
                color: #000 !important;
            }
            #app.print-mode .text-4xl, #app.print-mode .text-xl {
                color: #000 !important;
            }
        }
    </style>
</head>

<body class="h-full antialiased text-gray-100">

    <div id="app" class="min-h-full flex flex-col">

        <header class="bg-gray-800 shadow-lg sticky top-0 z-20">
            <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
                <h1 class="text-3xl font-bold text-blue-400 mb-4">Project Resource Control</h1>
                <div class="flex space-x-2 sm:space-x-4 border-b border-gray-700 pb-1 overflow-x-auto">
                    <button data-page="dashboard" class="page-tab px-4 py-2 text-sm font-medium rounded-t-lg transition-colors duration-200 border-b-2 border-transparent text-gray-400 hover:text-gray-100 data-[active=true]:text-blue-400 data-[active=true]:border-blue-500" data-active="true">
                        <i data-lucide="layout-dashboard" class="w-4 h-4 inline-block mr-1"></i> Dashboard
                    </button>
                    <button data-page="manpower" class="page-tab px-4 py-2 text-sm font-medium rounded-t-lg transition-colors duration-200 border-b-2 border-transparent text-gray-400 hover:text-gray-100 data-[active=true]:text-blue-400 data-[active=true]:border-blue-500">
                        <i data-lucide="users" class="w-4 h-4 inline-block mr-1"></i> Manpower
                    </button>
                    <button data-page="material" class="page-tab px-4 py-2 text-sm font-medium rounded-t-lg transition-colors duration-200 border-b-2 border-transparent text-gray-400 hover:text-gray-100 data-[active=true]:text-blue-400 data-[active=true]:border-blue-500">
                        <i data-lucide="brick-wall" class="w-4 h-4 inline-block mr-1"></i> Material
                    </button>
                    <button data-page="vehicles" class="page-tab px-4 py-2 text-sm font-medium rounded-t-lg transition-colors duration-200 border-b-2 border-transparent text-gray-400 hover:text-gray-100 data-[active=true]:text-blue-400 data-[active=true]:border-blue-500">
                        <i data-lucide="truck" class="w-4 h-4 inline-block mr-1"></i> V/E & Tools
                    </button>
                    <button data-page="overheads" class="page-tab px-4 py-2 text-sm font-medium rounded-t-lg transition-colors duration-200 border-b-2 border-transparent text-gray-400 hover:text-gray-100 data-[active=true]:text-blue-400 data-[active=true]:border-blue-500">
                        <i data-lucide="trending-up" class="w-4 h-4 inline-block mr-1"></i> Overheads
                    </button>
                    <button data-page="report" class="page-tab px-4 py-2 text-sm font-medium rounded-t-lg transition-colors duration-200 border-b-2 border-transparent text-gray-400 hover:text-gray-100 data-[active=true]:text-blue-400 data-[active=true]:border-blue-500">
                        <i data-lucide="printer" class="w-4 h-4 inline-block mr-1"></i> Project Report
                    </button>
                </div>
            </nav>
        </header>

        <main class="flex-grow max-w-7xl mx-auto p-4 sm:px-6 lg:px-8 flex flex-col gap-6">

            <section id="dashboard-view" class="w-full space-y-8 p-4 bg-gray-900 rounded-xl hidden">
                <h2 class="text-3xl font-bold text-gray-100 border-b border-gray-700 pb-3">Project Financial KPIs</h2>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    
                    <div class="kpi-card bg-gray-800 p-6 rounded-xl shadow-lg border-l-4 border-blue-500">
                        <div class="flex items-center space-x-3">
                            <i data-lucide="gauge" class="w-8 h-8 text-blue-400"></i>
                            <h3 class="text-lg font-semibold text-gray-300">Cost Performance Index (CPI)</h3>
                        </div>
                        <p id="kpi-cpi" class="text-4xl font-extrabold mt-3 text-blue-400">1.00</p>
                        <p id="kpi-cpi-status" class="text-sm mt-1 text-gray-400">On Target (Budget Efficiency)</p>
                    </div>

                    <div class="kpi-card bg-gray-800 p-6 rounded-xl shadow-lg border-l-4 border-yellow-500">
                        <div class="flex items-center space-x-3">
                            <i data-lucide="trending-up" class="w-8 h-8 text-yellow-400"></i>
                            <h3 class="text-lg font-semibold text-gray-300">Total Cost Variance (CV)</h3>
                        </div>
                        <p id="kpi-cv" class="text-4xl font-extrabold mt-3 text-yellow-400">0.00</p>
                        <p id="kpi-cv-status" class="text-sm mt-1 text-gray-400">Planned Qty - Actual Qty</p>
                    </div>

                    <div class="kpi-card bg-gray-800 p-6 rounded-xl shadow-lg border-l-4 border-green-500">
                        <div class="flex items-center space-x-3">
                            <i data-lucide="percent" class="w-8 h-8 text-green-400"></i>
                            <h3 class="text-lg font-semibold text-gray-300">Overall Utilization</h3>
                        </div>
                        <p id="kpi-utilization" class="text-4xl font-extrabold mt-3 text-green-400">0%</p>
                        <p class="text-sm mt-1 text-gray-400">Total Actual / Total Planned</p>
                    </div>

                    <div class="kpi-card bg-gray-800 p-6 rounded-xl shadow-lg border-l-4 border-red-500">
                        <div class="flex items-center space-x-3">
                            <i data-lucide="alert-triangle" class="w-8 h-8 text-red-400"></i>
                            <h3 class="text-lg font-semibold text-gray-300">Exceeded Resources</h3>
                        </div>
                        <p id="kpi-exceeded" class="text-4xl font-extrabold mt-3 text-red-400">0</p>
                        <p class="text-sm mt-1 text-gray-400">Items where Actual > Planned</p>
                    </div>

                </div>

                <div class="pt-6">
                    <h3 class="text-xl font-semibold text-gray-200 mb-4">Breakdown by Category</h3>
                    <div id="category-breakdown" class="space-y-4">
                        <p class="text-gray-500 italic text-center p-4">Loading category data...</p>
                    </div>
                </div>

            </section>

            <section id="report-view-content" class="w-full space-y-8 hidden">
                <h2 class="text-3xl font-bold text-gray-100 border-b border-gray-700 pb-3">Project Resource Summary Report</h2>
                <div id="report-kpi-summary" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    </div>
                
                <h3 class="text-2xl font-bold text-gray-200 mt-8 mb-4">Resource Details</h3>
                <div id="report-resource-tables" class="space-y-8">
                    </div>
                <div class="hidden-print flex justify-center mt-8">
                    <button onclick="window.print()" class="flex items-center py-3 px-6 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium transition duration-150">
                        <i data-lucide="printer" class="w-5 h-5 mr-2"></i> Generate Print Report (PDF)
                    </button>
                </div>
            </section>


            <div id="resource-manager-view" class="flex flex-col md:flex-row gap-6 hidden">
                <section id="control-panel" class="md:w-full md:max-w-sm flex-shrink-0 bg-gray-800 rounded-xl shadow-2xl p-6 h-fit sticky top-20">
                    <h2 id="form-title" class="text-2xl font-semibold mb-4 text-gray-100"><i data-lucide="plus-circle" class="w-6 h-6 inline-block mr-2 text-blue-400"></i> Add New Resource</h2>
                    <form id="resource-form" class="space-y-4">
                        <input type="hidden" id="item-id">
                        <input type="hidden" id="item-page">

                        <div>
                            <label for="title" class="block text-sm font-medium text-gray-300">Resource Name</label>
                            <input type="text" id="title" class="w-full mt-1 p-3 bg-gray-700 border border-gray-600 rounded-lg text-gray-100 focus:ring-blue-500 focus:border-blue-500 transition duration-150" placeholder="e.g., Concrete Mixer, Site Engineer, Cement Bag" maxlength="100" required>
                            <p id="title-error" class="text-sm text-red-400 mt-1 hidden"></p>
                        </div>

                        <div>
                            <label for="planned-qty" class="block text-sm font-medium text-gray-300">Planned Quantity (Qty/Hrs)</label>
                            <input type="number" id="planned-qty" min="0" step="any" class="w-full mt-1 p-3 bg-gray-700 border border-gray-600 rounded-lg text-gray-100 focus:ring-blue-500 focus:border-blue-500 transition duration-150" placeholder="e.g., 50 (Bags), 120 (Hours), 1 (Unit)" required>
                        </div>

                        <div>
                            <label for="actual-qty" class="block text-sm font-medium text-gray-300">Actual Used Quantity</label>
                            <input type="number" id="actual-qty" min="0" step="any" class="w-full mt-1 p-3 bg-gray-700 border border-gray-600 rounded-lg text-gray-100 focus:ring-blue-500 focus:border-blue-500 transition duration-150" placeholder="e.g., 55 (Bags), 130 (Hours), 1 (Unit)" required>
                        </div>

                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-300">Unit / Details</label>
                            <textarea id="description" rows="3" class="w-full mt-1 p-3 bg-gray-700 border border-gray-600 rounded-lg text-gray-100 focus:ring-blue-500 focus:border-blue-500 transition duration-150" placeholder="e.g., M3, Tons, Hours/Day. Add any verification notes."></textarea>
                        </div>

                        <button type="submit" id="submit-btn" class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 focus:ring-offset-gray-900 transition duration-150 transform hover:scale-[1.01] disabled:bg-gray-500 disabled:cursor-not-allowed">
                            <i data-lucide="save" class="w-5 h-5 mr-2"></i>
                            <span id="submit-text">Add Resource</span>
                        </button>
                        <button type="button" id="cancel-btn" class="w-full flex justify-center items-center py-2 px-4 border border-gray-600 rounded-lg shadow-sm text-sm font-medium text-gray-300 bg-gray-700 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 focus:ring-offset-gray-900 transition duration-150 hidden">
                            <i data-lucide="x" class="w-4 h-4 mr-2"></i> Cancel Edit
                        </button>
                    </form>

                    <div class="mt-8 pt-6 border-t border-gray-700 space-y-3">
                        <h3 class="text-lg font-semibold text-gray-200">Data Management</h3>
                        <button id="export-btn" class="w-full flex justify-center items-center py-2 px-4 border border-yellow-500 rounded-lg shadow-sm text-sm font-medium text-yellow-400 bg-gray-800 hover:bg-gray-700 transition duration-150 transform hover:scale-[1.01]">
                            <i data-lucide="download" class="w-4 h-4 mr-2"></i> Export Data (JSON)
                        </button>

                        <label for="import-file" class="w-full flex justify-center items-center py-2 px-4 border border-green-500 rounded-lg shadow-sm text-sm font-medium text-green-400 bg-gray-800 hover:bg-gray-700 cursor-pointer transition duration-150 transform hover:scale-[1.01]">
                            <i data-lucide="upload" class="w-4 h-4 mr-2"></i> Import Data (Merge JSON)
                            <input type="file" id="import-file" accept=".json" class="hidden">
                        </label>
                    </div>
                </section>

                <section id="list-panel" class="flex-grow w-full">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                        <div class="relative w-full sm:w-3/4">
                            <input type="text" id="search-input" placeholder="Search resources by name or unit..." class="w-full p-3 pl-10 bg-gray-800 border border-gray-700 rounded-xl text-gray-100 focus:ring-blue-500 focus:border-blue-500 transition duration-150 placeholder-gray-500">
                            <i data-lucide="search" class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                        </div>
                    </div>

                    <div id="items-list" class="space-y-4 custom-scrollbar overflow-x-auto">
                        <div id="loading-spinner" class="flex justify-center items-center p-8 text-blue-400">
                            <i data-lucide="loader" class="w-8 h-8 animate-spin mr-2"></i>
                            <span>Loading Resources...</span>
                        </div>
                        <p id="no-items-message" class="text-center text-gray-500 italic p-8 hidden">
                            No resources found for this category. Use the form on the left to add one!
                        </p>
                    </div>
                </section>
            </div>

        </main>

    </div>

    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2">
        </div>

    <div id="delete-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center transition-opacity duration-300 opacity-0 pointer-events-none" aria-modal="true" role="dialog">
        <div class="bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-sm transform scale-95 transition-all duration-300">
            <div class="text-center">
                <i data-lucide="alert-triangle" class="w-10 h-10 mx-auto text-red-500 mb-4"></i>
                <h3 class="text-lg font-semibold text-gray-100 mb-2">Confirm Deletion</h3>
                <p class="text-sm text-gray-400">Are you sure you want to delete this resource? This action cannot be undone.</p>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="modal-cancel-btn" class="px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded-lg hover:bg-gray-600 transition duration-150">Cancel</button>
                <button id="modal-delete-btn" class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition duration-150">Delete Permanently</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONSTANTS AND CONFIGURATION ---
            const DB_NAME = 'ProjectManagerDB';
            const STORE_NAME = 'items';
            const DB_VERSION = 1;
            const PAGES = ['dashboard', 'manpower', 'material', 'vehicles', 'overheads', 'report'];
            let db;
            let currentEditId = null;
            let currentDeleteId = null;
            let currentPage = 'dashboard'; 

            // --- DOM ELEMENTS ---
            const app = document.getElementById('app');
            const form = document.getElementById('resource-form');
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const cancelBtn = document.getElementById('cancel-btn');
            const itemsList = document.getElementById('items-list');
            const formTitle = document.getElementById('form-title');
            const titleInput = document.getElementById('title');
            const titleError = document.getElementById('title-error');
            const itemIdInput = document.getElementById('item-id');
            const itemPageInput = document.getElementById('item-page');
            const searchInput = document.getElementById('search-input');
            const deleteModal = document.getElementById('delete-modal');
            const modalDeleteBtn = document.getElementById('modal-delete-btn');
            const modalCancelBtn = document.getElementById('modal-cancel-btn');
            const loadingSpinner = document.getElementById('loading-spinner');
            const noItemsMessage = document.getElementById('no-items-message');
            
            // Dashboard & Report Elements
            const dashboardView = document.getElementById('dashboard-view');
            const resourceManagerView = document.getElementById('resource-manager-view');
            const categoryBreakdown = document.getElementById('category-breakdown');
            const reportViewContent = document.getElementById('report-view-content');
            const reportKpiSummary = document.getElementById('report-kpi-summary');
            const reportResourceTables = document.getElementById('report-resource-tables');

            const pageNames = {
                'manpower': 'Manpower Resources', 
                'material': 'Material Resources', 
                'vehicles': 'Vehicles & Equipment', 
                'overheads': 'Overheads & Sundries'
            };


            // --- UI HELPER FUNCTIONS ---

            /**
             * Displays a color-coded toast notification.
             * @param {string} message - The message to display.
             * @param {'success'|'danger'|'warning'} type - The type of notification.
             */
            const showToast = (message, type) => {
                const colors = {
                    success: { bg: 'bg-green-600', icon: 'check-circle' },
                    danger: { bg: 'bg-red-600', icon: 'alert-triangle' },
                    warning: { bg: 'bg-yellow-600', icon: 'alert-circle' }
                };
                const config = colors[type] || colors.success;

                const toast = document.createElement('div');
                toast.className = `flex items-center p-4 rounded-lg shadow-xl text-white ${config.bg} transform translate-x-full transition-transform duration-300`;
                toast.innerHTML = `
                    <i data-lucide="${config.icon}" class="w-5 h-5 mr-3 flex-shrink-0"></i>
                    <div class="text-sm font-medium">${message}</div>
                `;

                lucide.createIcons(); 

                document.getElementById('toast-container').appendChild(toast);

                // Animate in
                setTimeout(() => {
                    toast.classList.remove('translate-x-full');
                    toast.classList.add('translate-x-0');
                }, 10);

                // Auto-hide after 3 seconds
                setTimeout(() => {
                    toast.classList.remove('translate-x-0');
                    toast.classList.add('translate-x-full');
                    toast.addEventListener('transitionend', () => toast.remove());
                }, 3000);
            };

            /**
             * Renders the list of items to the DOM in a tabular format.
             * @param {Array} items - The list of item objects.
             */
            const renderItems = (items) => {
                itemsList.innerHTML = '';
                loadingSpinner.classList.add('hidden');
                noItemsMessage.classList.add('hidden');

                const filteredItems = items.filter(item => item.page === currentPage);

                if (filteredItems.length === 0) {
                    noItemsMessage.classList.remove('hidden');
                    return;
                }

                // Sort by timestamp descending (newest first)
                filteredItems.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                let tableHTML = `
                    <div class="overflow-x-auto bg-gray-800 rounded-xl shadow-lg">
                        <table class="min-w-full divide-y divide-gray-700">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Resource Name</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Unit / Details</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">Planned Qty</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">Actual Qty</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider">Variance</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider action-buttons">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700">
                `;

                filteredItems.forEach(item => {
                    const plannedQty = parseFloat(item.plannedQty) || 0;
                    const actualQty = parseFloat(item.actualQty) || 0;
                    const variance = (actualQty - plannedQty).toFixed(2);
                    const isExceeded = actualQty > plannedQty;
                    const varianceColor = isExceeded ? 'text-red-400 font-bold' : 'text-green-400';

                    tableHTML += `
                        <tr class="hover:bg-gray-700 transition duration-150">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-100">${item.title}</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-300 max-w-xs truncate">${item.description || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-blue-400">${plannedQty.toFixed(2)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-200">${actualQty.toFixed(2)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-center ${varianceColor}">${variance}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium action-buttons">
                                <div class="flex justify-center space-x-2">
                                    <button data-id="${item.id}" class="edit-btn p-1 text-gray-400 hover:text-blue-400 transition transform hover:scale-110" title="Edit">
                                        <i data-lucide="pencil" class="w-4 h-4"></i>
                                    </button>
                                    <button data-id="${item.id}" class="duplicate-btn p-1 text-gray-400 hover:text-yellow-400 transition transform hover:scale-110" title="Duplicate">
                                        <i data-lucide="copy" class="w-4 h-4"></i>
                                    </button>
                                    <button data-id="${item.id}" class="delete-btn p-1 text-gray-400 hover:text-red-400 transition transform hover:scale-110" title="Delete">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });

                tableHTML += `
                            </tbody>
                        </table>
                    </div>
                `;

                itemsList.innerHTML = tableHTML;
                lucide.createIcons();
            };

            /**
             * Populates the form fields for editing an item.
             * @param {object} item - The item object to edit.
             */
            const populateFormForEdit = (item) => {
                currentEditId = item.id;
                formTitle.innerHTML = `<i data-lucide="edit" class="w-6 h-6 inline-block mr-2 text-yellow-400"></i> Edit Resource (ID: ${item.id})`;
                titleInput.value = item.title;
                document.getElementById('planned-qty').value = item.plannedQty;
                document.getElementById('actual-qty').value = item.actualQty;
                document.getElementById('description').value = item.description;
                itemIdInput.value = item.id;
                itemPageInput.value = item.page;

                submitText.textContent = 'Update Resource';
                submitBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                submitBtn.classList.add('bg-yellow-600', 'hover:bg-yellow-700');
                cancelBtn.classList.remove('hidden');

                // Scroll to the form
                document.getElementById('control-panel').scrollIntoView({ behavior: 'smooth' });
            };

            /** Resets the form and UI state after an operation. */
            const resetForm = () => {
                currentEditId = null;
                form.reset();
                formTitle.innerHTML = `<i data-lucide="plus-circle" class="w-6 h-6 inline-block mr-2 text-blue-400"></i> Add New Resource`;
                itemIdInput.value = '';
                itemPageInput.value = currentPage; 

                submitText.textContent = 'Add Resource';
                submitBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                submitBtn.classList.remove('bg-yellow-600', 'hover:bg-yellow-700');
                cancelBtn.classList.add('hidden');
                titleError.classList.add('hidden');
                titleInput.classList.remove('border-red-500');
            };

            /**
             * Activates a new page tab and loads/filters data, or loads dashboard/report.
             * @param {string} page - The name of the page to activate.
             */
            const activatePage = (page) => {
                currentPage = page;
                document.querySelectorAll('.page-tab').forEach(tab => {
                    const isActive = tab.getAttribute('data-page') === page;
                    tab.setAttribute('data-active', isActive);
                });
                
                // Reset print mode class
                app.classList.remove('print-mode');

                // Toggle view sections
                if (page === 'dashboard') {
                    resourceManagerView.classList.add('hidden');
                    reportViewContent.classList.add('hidden');
                    dashboardView.classList.remove('hidden');
                    calculateKPIsAndRenderDashboard();
                } else if (page === 'report') {
                    resourceManagerView.classList.add('hidden');
                    dashboardView.classList.add('hidden');
                    reportViewContent.classList.remove('hidden');
                    app.classList.add('print-mode');
                    generatePrintReport();
                } else {
                    dashboardView.classList.add('hidden');
                    reportViewContent.classList.add('hidden');
                    resourceManagerView.classList.remove('hidden');
                    resetForm();
                    loadItems(); 
                }
            };

            // --- INDEXEDDB SETUP (Unchanged) ---

            /** Initializes the IndexedDB. */
            const initDB = () => {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(DB_NAME, DB_VERSION);

                    request.onerror = (event) => {
                        console.error("IndexedDB error:", event.target.errorCode);
                        showToast(`DB error: ${event.target.errorCode}`, 'danger');
                        reject('Database error');
                    };

                    request.onsuccess = (event) => {
                        db = event.target.result;
                        console.log("DB initialized successfully.");
                        resolve();
                    };

                    // Schema migration/creation
                    request.onupgradeneeded = (event) => {
                        db = event.target.result;
                        if (!db.objectStoreNames.contains(STORE_NAME)) {
                            const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                            objectStore.createIndex('page', 'page', { unique: false });
                            console.log("Object store created successfully.");
                        }
                    };
                });
            };

            // --- KPI & DASHBOARD LOGIC ---

            /** Fetches all data, calculates KPIs, and updates the dashboard. */
            const calculateKPIsAndRenderDashboard = async (forReport = false) => {
                let allItems = [];
                return new Promise((resolve, reject) => {
                    try {
                        const transaction = db.transaction([STORE_NAME], 'readonly');
                        const store = transaction.objectStore(STORE_NAME);
                        const request = store.getAll();

                        request.onsuccess = (event) => {
                            allItems = event.target.result;
                            
                            let totalPlannedQty = 0;
                            let totalActualQty = 0;
                            let exceededCount = 0;
                            const breakdown = {};

                            const resourcePages = PAGES.filter(p => p !== 'dashboard' && p !== 'report');
                            resourcePages.forEach(page => {
                                breakdown[page] = { planned: 0, actual: 0, exceeded: 0, items: [] };
                            });

                            allItems.forEach(item => {
                                const planned = parseFloat(item.plannedQty) || 0;
                                const actual = parseFloat(item.actualQty) || 0;

                                totalPlannedQty += planned;
                                totalActualQty += actual;

                                if (actual > planned) {
                                    exceededCount++;
                                }

                                if (breakdown[item.page]) {
                                    breakdown[item.page].planned += planned;
                                    breakdown[item.page].actual += actual;
                                    if (actual > planned) {
                                        breakdown[item.page].exceeded++;
                                    }
                                    breakdown[item.page].items.push(item);
                                }
                            });

                            // 1. Calculate Core KPIs
                            const costVariance = totalPlannedQty - totalActualQty; // CV
                            const costPerformanceIndex = totalActualQty === 0 ? 1.0 : totalPlannedQty / totalActualQty; // CPI
                            const utilization = totalPlannedQty === 0 ? 0 : (totalActualQty / totalPlannedQty) * 100;

                            const kpiData = {
                                cpi: costPerformanceIndex,
                                cv: costVariance,
                                utilization: utilization,
                                exceeded: exceededCount,
                                breakdown: breakdown,
                            };

                            if (!forReport) {
                                // 2. Render Core KPIs for Dashboard
                                document.getElementById('kpi-cpi').textContent = kpiData.cpi.toFixed(2);
                                document.getElementById('kpi-cv').textContent = kpiData.cv.toFixed(2);
                                document.getElementById('kpi-utilization').textContent = `${kpiData.utilization.toFixed(1)}%`;
                                document.getElementById('kpi-exceeded').textContent = kpiData.exceeded;

                                // Set CPI Status Text & Color
                                const cpiStatus = document.getElementById('kpi-cpi-status');
                                const cpiElement = document.getElementById('kpi-cpi');
                                cpiElement.classList.remove('text-blue-400', 'text-green-400', 'text-red-400');

                                if (kpiData.cpi > 1.05) {
                                    cpiStatus.textContent = 'Excellent! Running under budget.';
                                    cpiElement.classList.add('text-green-400');
                                } else if (kpiData.cpi >= 0.95) {
                                    cpiStatus.textContent = 'On Target (Budget Efficiency)';
                                    cpiElement.classList.add('text-blue-400');
                                } else {
                                    cpiStatus.textContent = 'Warning! Running over budget.';
                                    cpiElement.classList.add('text-red-400');
                                }

                                // 3. Render Breakdown
                                renderCategoryBreakdown(kpiData.breakdown);
                            }

                            resolve(kpiData);

                        };

                        request.onerror = (event) => {
                            console.error("Dashboard load error:", event.target.error);
                            showToast(`Failed to load dashboard data: ${event.target.error}`, 'danger');
                            reject(event.target.error);
                        };

                    } catch (e) {
                        console.error("Dashboard calculation error:", e);
                        showToast(`Critical dashboard error: ${e.message}`, 'danger');
                        reject(e);
                    }
                });
            };
            
            /** Renders the detailed breakdown for each resource category. */
            const renderCategoryBreakdown = (breakdown) => {
                categoryBreakdown.innerHTML = '';
                const resourcePages = PAGES.filter(p => p !== 'dashboard' && p !== 'report');

                resourcePages.forEach(page => {
                    const data = breakdown[page];
                    const planned = data.planned;
                    const actual = data.actual;
                    const utilizationPercent = planned === 0 ? 0 : (actual / planned) * 100;
                    const utilizationStatus = utilizationPercent > 100 ? 'text-red-400' : 'text-green-400';
                    const icon = (page === 'manpower') ? 'users' : (page === 'material' ? 'brick-wall' : (page === 'vehicles' ? 'truck' : 'trending-up'));

                    const card = document.createElement('div');
                    card.className = 'bg-gray-800 p-5 rounded-xl shadow-lg flex justify-between items-center transition duration-300 hover:bg-gray-700';
                    card.innerHTML = `
                        <div class="flex items-center space-x-4">
                            <i data-lucide="${icon}" class="w-8 h-8 text-blue-400"></i>
                            <div>
                                <h4 class="text-xl font-bold text-gray-100">${pageNames[page]}</h4>
                                <p class="text-sm text-gray-400">${data.exceeded} resources exceeded their planned quantity.</p>
                            </div>
                        </div>
                        <div class="text-right space-y-1">
                            <p class="text-sm font-medium text-gray-300">Planned: <span class="text-blue-400">${planned.toFixed(2)}</span></p>
                            <p class="text-sm font-medium text-gray-300">Actual: <span class="${utilizationStatus}">${actual.toFixed(2)}</span></p>
                            <p class="text-lg font-bold ${utilizationStatus}">${utilizationPercent.toFixed(1)}% Usage</p>
                        </div>
                    `;
                    categoryBreakdown.appendChild(card);
                });
                lucide.createIcons();
            };

            // --- REPORT GENERATION LOGIC ---

            /** Generates the full report content (KPIs + all tables) */
            const generatePrintReport = async () => {
                try {
                    const kpiData = await calculateKPIsAndRenderDashboard(true);
                    
                    // 1. Render KPI Summary (Cloning the dashboard style for report)
                    reportKpiSummary.innerHTML = `
                        <div class="kpi-card bg-gray-800 p-4 rounded-lg shadow-md border-l-4 border-blue-500">
                            <p class="text-sm font-semibold text-gray-400">CPI</p>
                            <p class="text-3xl font-extrabold ${kpiData.cpi > 1 ? 'text-green-400' : (kpiData.cpi < 0.95 ? 'text-red-400' : 'text-blue-400')}">${kpiData.cpi.toFixed(2)}</p>
                        </div>
                        <div class="kpi-card bg-gray-800 p-4 rounded-lg shadow-md border-l-4 border-yellow-500">
                            <p class="text-sm font-semibold text-gray-400">Cost Variance</p>
                            <p class="text-3xl font-extrabold ${kpiData.cv < 0 ? 'text-red-400' : 'text-green-400'}">${kpiData.cv.toFixed(2)}</p>
                        </div>
                        <div class="kpi-card bg-gray-800 p-4 rounded-lg shadow-md border-l-4 border-green-500">
                            <p class="text-sm font-semibold text-gray-400">Utilization</p>
                            <p class="text-3xl font-extrabold ${kpiData.utilization > 100 ? 'text-red-400' : 'text-green-400'}">${kpiData.utilization.toFixed(1)}%</p>
                        </div>
                        <div class="kpi-card bg-gray-800 p-4 rounded-lg shadow-md border-l-4 border-red-500">
                            <p class="text-sm font-semibold text-gray-400">Exceeded</p>
                            <p class="text-3xl font-extrabold text-red-400">${kpiData.exceeded}</p>
                        </div>
                    `;
                    
                    // 2. Render all Resource Tables
                    reportResourceTables.innerHTML = '';
                    const resourcePages = PAGES.filter(p => p !== 'dashboard' && p !== 'report');
                    
                    resourcePages.forEach(page => {
                        const pageData = kpiData.breakdown[page];
                        if (pageData && pageData.items.length > 0) {
                            reportResourceTables.innerHTML += `
                                <div class="space-y-3">
                                    <h4 class="text-xl font-semibold text-gray-100">${pageNames[page]} (${pageData.items.length} Resources)</h4>
                                    ${renderReportTable(pageData.items)}
                                </div>
                            `;
                        } else {
                             reportResourceTables.innerHTML += `<p class="text-gray-500 italic">No data recorded for ${pageNames[page]}.</p>`;
                        }
                    });

                    lucide.createIcons();

                } catch (error) {
                    reportResourceTables.innerHTML = `<p class="text-red-400">Error generating report data.</p>`;
                    console.error("Report generation error:", error);
                }
            };

            /** Renders a concise HTML table for the print report. */
            const renderReportTable = (items) => {
                // Sort by Resource Name (Title) for consistency in the report
                items.sort((a, b) => a.title.localeCompare(b.title));

                let tableHTML = `
                    <div class="overflow-x-auto bg-gray-800 rounded-lg shadow-md">
                        <table class="min-w-full divide-y divide-gray-700 text-gray-300">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th class="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">Resource Name</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider">Unit / Details</th>
                                    <th class="px-3 py-2 text-right text-xs font-medium uppercase tracking-wider">Planned</th>
                                    <th class="px-3 py-2 text-right text-xs font-medium uppercase tracking-wider">Actual</th>
                                    <th class="px-3 py-2 text-right text-xs font-medium uppercase tracking-wider">Variance</th>
                                    <th class="px-3 py-2 text-right text-xs font-medium uppercase tracking-wider">Date</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700">
                `;

                items.forEach(item => {
                    const plannedQty = parseFloat(item.plannedQty) || 0;
                    const actualQty = parseFloat(item.actualQty) || 0;
                    const variance = (plannedQty - actualQty).toFixed(2);
                    const isOver = actualQty > plannedQty;
                    const varianceColor = isOver ? 'text-red-400 font-bold' : 'text-green-400';
                    const date = new Date(item.timestamp).toLocaleDateString();

                    tableHTML += `
                        <tr class="hover:bg-gray-700 transition duration-100">
                            <td class="px-3 py-2 text-sm font-medium text-gray-100">${item.title}</td>
                            <td class="px-3 py-2 text-sm text-gray-300">${item.description ? item.description.substring(0, 50) + (item.description.length > 50 ? '...' : '') : '-'}</td>
                            <td class="px-3 py-2 text-sm text-right text-blue-400">${plannedQty.toFixed(2)}</td>
                            <td class="px-3 py-2 text-sm text-right text-gray-200">${actualQty.toFixed(2)}</td>
                            <td class="px-3 py-2 text-sm text-right ${varianceColor}">${variance}</td>
                            <td class="px-3 py-2 text-sm text-right text-gray-500">${date}</td>
                        </tr>
                    `;
                });

                tableHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
                return tableHTML;
            }


            // --- CRUD OPERATIONS (Unchanged) ---

            /**
             * Saves a new item or updates an existing one.
             * @param {object} itemData - The data object for the item.
             */
            const saveItem = async (itemData) => {
                submitBtn.disabled = true;
                const originalText = submitText.textContent;
                submitText.textContent = currentEditId ? 'Updating...' : 'Saving...';
                
                // Client-side validation
                if (!itemData.title.trim()) {
                    titleError.textContent = 'Resource Name is required.';
                    titleError.classList.remove('hidden');
                    titleInput.classList.add('border-red-500');
                    submitBtn.disabled = false;
                    submitText.textContent = originalText;
                    showToast('Validation failed: Resource Name missing.', 'warning');
                    return;
                } else {
                    titleError.classList.add('hidden');
                    titleInput.classList.remove('border-red-500');
                }

                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);

                const item = {
                    title: itemData.title.trim(),
                    description: itemData.description.trim(),
                    plannedQty: parseFloat(itemData.plannedQty) || 0,
                    actualQty: parseFloat(itemData.actualQty) || 0,
                    page: itemData.page || currentPage, // Ensure page is set
                    timestamp: new Date().toISOString(),
                };

                let request;
                let isUpdate = false;

                if (currentEditId) {
                    item.id = currentEditId; 
                    request = store.put(item);
                    isUpdate = true;
                } else {
                    request = store.add(item);
                }

                request.onsuccess = () => {
                    showToast(`Resource ${isUpdate ? 'Updated' : 'Added'} successfully!`, 'success');
                    resetForm();
                    loadItems(); 
                };

                request.onerror = (event) => {
                    console.error("Save error:", event.target.error);
                    showToast(`Failed to save resource: ${event.target.error}`, 'danger');
                };

                transaction.oncomplete = () => {
                    submitBtn.disabled = false;
                    submitText.textContent = isUpdate ? 'Update Resource' : 'Add Resource';
                    if (!isUpdate) resetForm(); 
                };
                transaction.onerror = () => {
                     submitBtn.disabled = false;
                     submitText.textContent = isUpdate ? 'Update Resource' : 'Add Resource';
                }
            };

            /** Loads all items from the DB and renders them. */
            const loadItems = async () => {
                if(currentPage === 'dashboard' || currentPage === 'report') return;
                try {
                    loadingSpinner.classList.remove('hidden');
                    const transaction = db.transaction([STORE_NAME], 'readonly');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.getAll();

                    request.onsuccess = (event) => {
                        const allItems = event.target.result;
                        const searchTerm = searchInput.value.toLowerCase().trim();
                        const filteredItems = searchTerm
                            ? allItems.filter(item =>
                                (item.title && item.title.toLowerCase().includes(searchTerm)) ||
                                (item.description && item.description.toLowerCase().includes(searchTerm))
                            )
                            : allItems;

                        renderItems(filteredItems);
                    };

                    request.onerror = (event) => {
                        console.error("Load error:", event.target.error);
                        showToast(`Failed to load items: ${event.target.error}`, 'danger');
                        loadingSpinner.classList.add('hidden');
                    };
                } catch (e) {
                    console.error("Load catch error:", e);
                    showToast(`Critical load error: ${e.message}`, 'danger');
                    loadingSpinner.classList.add('hidden');
                }
            };

            /**
             * Deletes an item by its ID.
             * @param {number} id - The ID of the item to delete.
             */
            const deleteItem = (id) => {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.delete(id);

                request.onsuccess = () => {
                    showToast('Resource deleted successfully.', 'success');
                    closeModal();
                    loadItems(); 
                    if (currentEditId === id) resetForm(); 
                };

                request.onerror = (event) => {
                    console.error("Delete error:", event.target.error);
                    showToast(`Failed to delete resource: ${event.target.error}`, 'danger');
                    closeModal();
                };
            };

            /**
             * Duplicates an item by its ID.
             * @param {number} id - The ID of the item to duplicate.
             */
            const duplicateItem = async (id) => {
                try {
                    const transaction = db.transaction([STORE_NAME], 'readonly');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.get(id);

                    request.onsuccess = () => {
                        const originalItem = request.result;
                        if (originalItem) {
                            const newItem = {
                                title: `COPY: ${originalItem.title}`,
                                description: originalItem.description,
                                plannedQty: originalItem.plannedQty,
                                actualQty: originalItem.actualQty,
                                page: originalItem.page,
                                timestamp: new Date().toISOString(),
                            };

                            const writeTransaction = db.transaction([STORE_NAME], 'readwrite');
                            const writeStore = writeTransaction.objectStore(STORE_NAME);
                            const addRequest = writeStore.add(newItem);

                            addRequest.onsuccess = () => {
                                showToast(`Resource duplicated successfully.`, 'warning');
                                loadItems();
                            };
                            addRequest.onerror = (event) => {
                                console.error("Duplicate save error:", event.target.error);
                                showToast(`Failed to duplicate: ${event.target.error}`, 'danger');
                            };
                        }
                    };
                } catch (e) {
                    console.error("Duplicate item error:", e);
                    showToast(`Critical duplication error: ${e.message}`, 'danger');
                }
            };


            // --- MODAL CONTROL (Unchanged) ---

            /** Opens the delete confirmation modal. */
            const openModal = (id) => {
                currentDeleteId = id;
                document.body.classList.add('modal-open');
                deleteModal.classList.remove('opacity-0', 'pointer-events-none');
                deleteModal.querySelector('div').classList.remove('scale-95');
                deleteModal.querySelector('div').classList.add('scale-100');
            };

            /** Closes the delete confirmation modal. */
            const closeModal = () => {
                currentDeleteId = null;
                document.body.classList.remove('modal-open');
                deleteModal.querySelector('div').classList.remove('scale-100');
                deleteModal.querySelector('div').classList.add('scale-95');
                deleteModal.classList.add('opacity-0', 'pointer-events-none');
            };

            // --- DATA IMPORT/EXPORT (Unchanged) ---

            /** Exports all data to a JSON file. */
            const exportData = async () => {
                try {
                    const transaction = db.transaction([STORE_NAME], 'readonly');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.getAll();

                    request.onsuccess = () => {
                        const data = JSON.stringify(request.result, null, 2);
                        const blob = new Blob([data], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `project_resource_data_${new Date().toISOString().slice(0, 10)}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        showToast('Data successfully exported.', 'success');
                    };
                    request.onerror = () => {
                        showToast('Failed to read data for export.', 'danger');
                    };
                } catch (e) {
                    showToast(`Export error: ${e.message}`, 'danger');
                }
            };

            /** Imports data from a JSON file (non-destructive merge). */
            const importData = (file) => {
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (!Array.isArray(importedData)) {
                            throw new Error('JSON file format invalid (must be an array).');
                        }

                        const transaction = db.transaction([STORE_NAME], 'readwrite');
                        const store = transaction.objectStore(STORE_NAME);
                        let importedCount = 0;

                        importedData.forEach(item => {
                            const newItem = {
                                title: item.title,
                                description: item.description,
                                plannedQty: item.plannedQty,
                                actualQty: item.actualQty,
                                page: item.page || 'manpower', 
                                timestamp: new Date().toISOString(), 
                            };
                            delete newItem.id;
                            store.add(newItem).onsuccess = () => {
                                importedCount++;
                            };
                        });

                        transaction.oncomplete = () => {
                            showToast(`Successfully imported and merged ${importedCount} records.`, 'success');
                            activatePage(currentPage); 
                        };

                        transaction.onerror = (event) => {
                            showToast(`Import error during transaction: ${event.target.error}`, 'danger');
                        };

                    } catch (error) {
                        console.error('Import process failed:', error);
                        showToast(`Import failed: ${error.message}`, 'danger');
                    }
                };
                reader.readAsText(file);
            };

            // --- EVENT LISTENERS (Updated to handle new page) ---

            // Form Submission (Create/Update)
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const itemData = {
                    title: document.getElementById('title').value,
                    description: document.getElementById('description').value,
                    plannedQty: document.getElementById('planned-qty').value,
                    actualQty: document.getElementById('actual-qty').value,
                    page: currentPage,
                    id: itemIdInput.value ? parseInt(itemIdInput.value) : null
                };
                saveItem(itemData);
            });

            // Cancel Edit
            cancelBtn.addEventListener('click', resetForm);

            // Item Action Delegation (Edit/Delete/Duplicate)
            itemsList.addEventListener('click', (e) => {
                const target = e.target.closest('button');
                if (!target) return;

                const id = parseInt(target.getAttribute('data-id'));
                if (isNaN(id)) return;

                if (target.classList.contains('edit-btn')) {
                    const transaction = db.transaction([STORE_NAME], 'readonly');
                    const store = transaction.objectStore(STORE_NAME);
                    store.get(id).onsuccess = (event) => {
                        populateFormForEdit(event.target.result);
                    };
                } else if (target.classList.contains('delete-btn')) {
                    openModal(id);
                } else if (target.classList.contains('duplicate-btn')) {
                    duplicateItem(id);
                }
            });

            // Delete Modal Handlers
            modalDeleteBtn.addEventListener('click', () => {
                if (currentDeleteId !== null) {
                    deleteItem(currentDeleteId);
                }
            });
            modalCancelBtn.addEventListener('click', closeModal);
            deleteModal.addEventListener('click', (e) => {
                if (e.target === deleteModal) closeModal(); 
            });

            // Search Filter
            searchInput.addEventListener('input', loadItems);

            // Page Navigation
            document.querySelectorAll('.page-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const page = tab.getAttribute('data-page');
                    activatePage(page);
                });
            });

            // Data Export/Import
            document.getElementById('export-btn').addEventListener('click', exportData);
            document.getElementById('import-file').addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    importData(e.target.files[0]);
                    e.target.value = ''; 
                }
            });


            // --- INITIALIZATION ---
            initDB()
                .then(() => {
                    activatePage('dashboard');
                })
                .catch(e => {
                    console.error("App failed to initialize:", e);
                    document.getElementById('loading-spinner').innerHTML = `<p class="text-red-400">Application failed to initialize database. Please check console.</p>`;
                });
        });
    </script>

</body>
</html>