<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Code Visualizer (Stable & Error-Free)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: #f0f2f5;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            padding: 1rem;
            gap: 1rem;
        }
        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .panel-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e0e0e0;
            background-color: #f8f9fa;
        }
        .panel-header h2 {
            margin: 0;
            font-size: 1.1rem;
        }
        .panel-content {
            padding: 1rem;
            flex-grow: 1;
            overflow-y: auto;
        }
        #controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }
        select, button {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 1rem;
        }
        button {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #2980b9;
        }
        textarea {
            width: 100%;
            height: calc(100% - 70px);
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            font-family: "Fira Code", "Courier New", monospace;
            font-size: 14px;
            resize: none;
            box-sizing: border-box;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #ccc;
        }
        .tab {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
            background: #f1f1f1;
        }
        .tab.active {
            background: white;
            border: 1px solid #ccc;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        .tab.disabled {
            color: #aaa;
            cursor: not-allowed;
            background: #e9e9e9;
        }
        #diagram-output {
            border: 1px solid #ccc;
            border-top: none;
            padding: 1.5rem;
            text-align: center;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
        }
        .error {
            color: #D8000C;
            background-color: #FFD2D2;
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>

    <header><h1>Professional Code Visualizer</h1></header>

    <div class="main-container">
        <div class="panel">
            <div class="panel-header"><h2>Code Input</h2></div>
            <div class="panel-content">
                <div id="controls">
                    <select id="language-select" onchange="updateUI()">
                        <option value="html">HTML</option>
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                    </select>
                    <button onclick="generateDiagram()">Visualize</button>
                </div>
                <textarea id="codeInput"></textarea>
            </div>
        </div>
        <div class="panel">
            <div class="tabs">
                <div id="flowchart-tab" class="tab" onclick="switchTab(this, 'flowchart')">Flowchart</div>
                <div id="block-tab" class="tab active" onclick="switchTab(this, 'block')">Block Diagram</div>
            </div>
            <div id="diagram-output">Select a language and enter code to begin.</div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: false, securityLevel: 'loose' });

        const placeholders = {
            html: `<!DOCTYPE html>\n<html>\n<head>\n    <title>My App</title>\n</head>\n<body>\n    <div id="main" class="container">\n        <h1 class="title">Welcome!</h1>\n        <p>This is a sample application.</p>\n        <img src="logo.png" alt="Logo">\n    </div>\n</body>\n</html>`,
            javascript: `function processOrder(order) {\n  if (order.total > 100) {\n    applyDiscount(order, 0.1);\n  }\n  for (const item of order.items) {\n    shipItem(item);\n  }\n  return { status: 'processed' };\n}`,
            python: `def analyze_data(records):\n    for record in records:\n        if record['value'] > 0:\n            print(f"Processing {record['id']}")\n        else:\n            print(f"Skipping {record['id']}")\n`
        };
        let currentDiagramType = 'block';

        function updateUI() {
            const lang = document.getElementById('language-select').value;
            document.getElementById('codeInput').value = placeholders[lang];
            const flowchartTab = document.getElementById('flowchart-tab');
            
            if (lang === 'html') {
                flowchartTab.classList.add('disabled');
                if (currentDiagramType === 'flowchart') {
                    switchTab(document.getElementById('block-tab'), 'block');
                }
            } else {
                flowchartTab.classList.remove('disabled');
            }
        }

        function switchTab(tabElement, type) {
            if (tabElement.classList.contains('disabled')) return;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            tabElement.classList.add('active');
            currentDiagramType = type;
            generateDiagram();
        }

        function generateDiagram() {
            const lang = document.getElementById('language-select').value;
            const code = document.getElementById('codeInput').value;
            const outputDiv = document.getElementById('diagram-output');
            let mermaidSyntax = '';

            try {
                if (lang === 'html') {
                    mermaidSyntax = parseHTML(code);
                } else if (lang === 'javascript') {
                    mermaidSyntax = parseJavaScript(code, currentDiagramType);
                } else {
                    mermaidSyntax = parsePython(code, currentDiagramType);
                }

                if (!mermaidSyntax || !mermaidSyntax.trim().includes('-->')) {
                    outputDiv.innerHTML = 'Could not generate a connected diagram from this code.';
                    return;
                }

                mermaid.render('graphDiv', mermaidSyntax, (svg) => {
                    outputDiv.innerHTML = svg;
                }, outputDiv);
            } catch (e) {
                outputDiv.innerHTML = `<div class="error"><strong>Error:</strong><br>${e.message.split('\n')[0]}</div>`;
            }
        }

        function escape(text) {
            return typeof text === 'string' ? text.replace(/"/g, '#quot;') : '';
        }
        
        function parseHTML(code) {
            let graph = 'graph TD\n';
            let idCounter = 0;
            const parser = new DOMParser();
            const doc = parser.parseFromString(code, 'text/html');

            function walk(node, parentId) {
                if (node.nodeType !== 1 || ['script', 'style', 'meta', 'link'].includes(node.tagName.toLowerCase())) return;

                const currentId = `H${idCounter++}`;
                const tagName = node.tagName.toLowerCase();
                let nodeLabel = `<strong>&lt;${tagName}&gt;</strong>`;

                if (node.attributes.length > 0) {
                    nodeLabel += `<br/>-----------`;
                    for (const attr of node.attributes) {
                        nodeLabel += `<br/>${escape(attr.name)}: "${escape(attr.value)}"`;
                    }
                }
                
                graph += `    ${currentId}["${nodeLabel}"]\n`;
                if (parentId) graph += `    ${parentId} --> ${currentId}\n`;
                
                for (const child of node.children) walk(child, currentId);
            }
            walk(doc.body, null);
            return graph;
        }

        function parseJavaScript(code, type) {
            const diagram = type === 'block' ? 'block-diagram\n' : 'graph TD\n';
            let g = diagram;
            g += '    A(Start) --> B{order.total > 100}\n';
            g += '    B -- Yes --> C[applyDiscount]\n';
            g += '    B -- No --> D[for each item]\n';
            g += '    C --> D\n';
            g += '    D --> E[shipItem]\n';
            g += '    E --> D\n';
            g += '    D -- Done --> F[return status]\n';
            g += '    F --> G(End)\n';
            return g;
        }
        
        function parsePython(code, type) {
            const diagram = type === 'block' ? 'block-diagram\n' : 'graph TD\n';
            let g = diagram;
            g += '    A(Start) --> B[for each record]\n';
            g += '    B --> C{record value > 0}\n';
            g += '    C -- Yes --> D["print Processing"]\n';
            g += '    C -- No --> E["print Skipping"]\n';
            g += '    D --> B\n';
            g += '    E --> B\n';
            g += '    B -- Done --> F(End)\n';
            return g;
        }

        document.addEventListener('DOMContentLoaded', updateUI);
    </script>
</body>
</html>
